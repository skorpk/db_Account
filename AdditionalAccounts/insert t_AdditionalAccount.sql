USE AccountOMSReports
--использовать БД AccountOMSReports на srvsql1-st2, когда перенесу финансирование
GO
--SELECT TOP 3 * FROM dbo.t_AdditionalAccounts WHERE ReportMonth=9 AND rf_idV006=3
--SELECT TOP 3 * FROM dbo.t_AdditionalAccounts WHERE ReportMonth=9 AND rf_idV006=4

BEGIN TRANSACTION
INSERT dbo.t_AdditionalAccounts
        ( CodeLPU ,
          CodeSMO ,
          ReportMonth ,
          ReportYear ,
          NumberRegister ,
          Letter ,
          DateRegistration ,
          DateAccount ,
          AmountPayment
        )
SELECT CodeLPU ,CodeSMO ,ReportMonth ,ReportYear ,NumberRegister ,Letter 
	   ,DATEADD(DAY,-2,cast(v.Dateregistration AS datetime))
	   ,DATEADD(DAY,-2,CAST(cast(v.DateAccount AS datetime) AS DATE)) 
	   ,AmountPayment
FROM (VALUES('141022','34002',4,4,2019,'P',43593,43585,926304),
('301001','34002',4,4,2019,'P',43593,43585,2388820),
('311001','34002',4,4,2019,'P',43593,43585,112595),
('321001','34002',4,4,2019,'P',43593,43585,942715),
('331001','34002',4,4,2019,'P',43593,43585,1516132),
('341001','34002',4,4,2019,'P',43593,43585,126918),
('351001','34002',4,4,2019,'P',43593,43585,3846105),
('361001','34002',4,4,2019,'P',43593,43585,106159),
('371001','34002',4,4,2019,'P',43593,43585,171202),
('381001','34002',4,4,2019,'P',43593,43585,5932184),
('401001','34002',4,4,2019,'P',43593,43585,1644246),
('411001','34002',4,4,2019,'P',43593,43585,3263561),
('421001','34002',4,4,2019,'P',43593,43585,172776),
('431001','34002',4,4,2019,'P',43593,43585,218672),
('441001','34002',4,4,2019,'P',43593,43585,349205),
('461001','34002',4,4,2019,'P',43593,43585,1747020),
('471001','34002',4,4,2019,'P',43593,43585,105086),
('481001','34002',4,4,2019,'P',43593,43585,3044813),
('491001','34002',4,4,2019,'P',43593,43585,4088499),
('501001','34002',4,4,2019,'P',43593,43585,90828),
('511001','34002',4,4,2019,'P',43593,43585,105072),
('521001','34002',4,4,2019,'P',43593,43585,164949),
('531001','34002',4,4,2019,'P',43593,43585,3297683),
('541001','34002',4,4,2019,'P',43593,43585,72621),
('551001','34002',4,4,2019,'P',43593,43585,371237),
('561001','34002',4,4,2019,'P',43593,43585,4300843),
('571001','34002',4,4,2019,'P',43593,43585,547559),
('581001','34002',4,4,2019,'P',43593,43585,45638),
('591001','34002',4,4,2019,'P',43593,43585,6861259),
('621001','34002',4,4,2019,'P',43593,43585,3119866),
('141022','34007',4,4,2019,'P',43593,43585,4607067),
('301001','34007',4,4,2019,'P',43593,43585,946793),
('311001','34007',4,4,2019,'P',43593,43585,2718052),
('321001','34007',4,4,2019,'P',43593,43585,6548875),
('331001','34007',4,4,2019,'P',43593,43585,147784),
('341001','34007',4,4,2019,'P',43593,43585,4305043),
('351001','34007',4,4,2019,'P',43593,43585,2410214),
('361001','34007',4,4,2019,'P',43593,43585,4043224),
('371001','34007',4,4,2019,'P',43593,43585,4811059),
('381001','34007',4,4,2019,'P',43593,43585,2460016),
('401001','34007',4,4,2019,'P',43593,43585,566906),
('411001','34007',4,4,2019,'P',43593,43585,215496),
('421001','34007',4,4,2019,'P',43593,43585,5817122),
('431001','34007',4,4,2019,'P',43593,43585,3779434),
('441001','34007',4,4,2019,'P',43593,43585,3780592),
('461001','34007',4,4,2019,'P',43593,43585,110648),
('471001','34007',4,4,2019,'P',43593,43585,4051610),
('481001','34007',4,4,2019,'P',43593,43585,1653524),
('491001','34007',4,4,2019,'P',43593,43585,152240),
('501001','34007',4,4,2019,'P',43593,43585,3104140),
('511001','34007',4,4,2019,'P',43593,43585,3327634),
('521001','34007',4,4,2019,'P',43593,43585,4353378),
('531001','34007',4,4,2019,'P',43593,43585,506796),
('541001','34007',4,4,2019,'P',43593,43585,3191271),
('551001','34007',4,4,2019,'P',43593,43585,5183214),
('561001','34007',4,4,2019,'P',43593,43585,543310),
('571001','34007',4,4,2019,'P',43593,43585,5932297),
('581001','34007',4,4,2019,'P',43593,43585,2587924),
('591001','34007',4,4,2019,'P',43593,43585,486125),
('621001','34007',4,4,2019,'P',43593,43585,146425)
) v(CodeLPU,CodeSMO,ReportMonth,NumberRegister,ReportYear,Letter,Dateregistration,DateAccount,AmountPayment)

SELECT @@ROWCOUNT

SELECT COUNT(*),rf_idV006 FROM dbo.t_AdditionalAccounts WHERE ReportMonth=4 AND reportyear=2019  AND rf_idV006=5 GROUP BY rf_idV006

--SELECT * FROM dbo.t_AdditionalAccounts WHERE ReportMonth=4 AND reportyear=2019 AND rf_idV006=5

commit
--ROLLBACK
--
