USE AccountOMS
GO
DECLARE @dateStart DATETIME='20210101',
		@dateEnd DATETIME=GETDATE()

CREATE TABLE #t(GUID_ZSL UNIQUEIDENTIFIER)

INSERT #t VALUES('F56656F6-C1E1-4D9B-98C0-1A768C2C3028'),('57627707-0891-4FA4-88CF-3B4E26CF3FB9'),('8D13A854-4B42-4083-BDC4-2985D97AB21D'),('5B7AD1DD-DB0E-452A-8ADA-3B0DC814B646'),('EBA220EE-3B19-4B29-8CF7-928D8D54CF6B'),
('D7F2EB6A-05CA-4E59-BEC0-BF42C62B0BAC'),('FCCEC9F0-5D7B-4FD2-AB0D-5B5ECA1C45CA'),('04E4EB69-CC16-4406-A034-436705B9AF21'),('D81EEF7F-0571-45C3-AEE9-538499C50F22'),
('FDF36AB8-341F-4A9C-8CA6-85A5D6DAB551'),('60554E90-5DB4-4F0B-91DE-10A21328518A'),('A150720C-F7B9-46C4-936C-0700F262758C'),('71BF9F90-DD57-4F76-9560-80388EABE55D'),
('E87C5168-CCC8-478F-9F62-FC29483018D6'),('9E8E7187-11BC-4BA7-9D32-E23AA7E91D9E'),('E9BAFF55-81E6-4ED1-8263-2A26CBF73D7E'),('AB47977E-A708-4945-ADEB-D682730E6275'),
('E242943D-6EFB-4572-97F7-B733703702FB'),('61CA7430-A9AF-4541-9765-E709717D0132'),('EE216FA2-5494-41DF-9BC2-5771E66188EF'),('5CF89014-AF7E-4298-B1E2-7C5AF1363C91'),
('24DA8989-6DAA-47CC-AB9C-B62ACBBBB924'),('DDA2AE53-932F-4D71-91E9-82609E47297B'),('A8A7CA84-16FD-4FAE-A9BC-A19381355804'),('CB083C72-7D31-4358-B55E-B883AF7F39AA'),
('87A7402D-4879-437B-9C2A-B68ABCEA6A71'),('8B161F54-E9E3-483D-BF00-F538AD1AAF59'),('EAC78C6B-ABF9-4A29-AF90-46CA902988D7'),('FC2F73F7-6CAD-4D99-A5D8-C48A36BC36F3'),
('44B35758-9A61-4DBF-A46F-DB6DB5D3BE42'),('07EAA8CA-BE1A-4099-A561-B38EF05909D7'),('7A9B08E6-5D2B-4BC2-A75B-B8CD3890C7C5'),('15B45C19-AE37-4115-8D1D-260C83F236AD'),
('21E8B86B-153A-438A-8CDF-7D992F2D5A6D'),('08EE1D7B-EACE-4594-B64A-B18EA82F3E48'),('E3CA0EF1-7324-498A-AD90-9CD367FA7790'),('A3D912C6-6C20-47C5-A5AD-7F2EFFE742FE'),
('F80FBBE0-58EB-465D-91ED-503FF0F23F50'),('5D7D0F03-BF8C-4B81-A596-D6758BFFA63E'),('FB22FD07-9625-402A-86BA-025655FF6C21'),('02DE596A-8019-4DF6-94A2-4A7BAD99D2FA'),
('FB012A73-4B8A-452B-9600-BB2ADB69C324'),('C13F3E43-F254-4005-BCEF-8CAA23FF9862'),('645CFA92-3B23-4ECF-9E94-16F77E8069BB'),('C761E66D-4AD0-45F4-84EC-77B3871835E5'),
('CA8CB428-3B79-46DF-963F-2DCDB5B97F48'),('47815C21-7051-4713-81AF-64758B210E2C'),('5188E96D-8C29-4858-87DF-F73ABEB50BAD'),('9820ACC1-8BAD-46D7-B674-B477DCD15E40'),
('4D919867-28CF-4A3E-B507-FE5AAABD60EA'),('B0BE9DFC-E9B0-4263-BFAA-C9ECF7144B33'),('6636A9D6-F0A8-460A-9EBF-EE53A0726B7F'),('63B0E875-664D-4069-949D-B95BFCBE4FEA'),
('ED7659B7-E03F-41A8-84B1-200B2C5A6BF6'),('F1D882D0-8752-49E6-AA41-3A0E210522F7'),('3819A75B-67BD-498F-899D-C080C92A8E25'),('3A8CB0EB-AF1F-41D2-A71A-6E6F9F74229F'),
('AAAE3BC9-D0D7-4FB8-8436-5EBA92B719AF'),('B71C8459-170C-49B0-904F-910E4C94F2A7'),('839DC20F-47AF-44AC-A0CF-C1F7158FF0A0'),('473D0D52-43D0-4F5B-9732-E46BDC08F1B8'),
('A74ECD73-1239-4D48-86A7-3A485AAD4811'),('2003269A-673A-44B8-81B9-4E24A7DD5F63'),('1DC73A6A-DB1A-4BA1-8727-DB82D3DA9F03'),('5B83BF9B-FEB0-48F6-A51A-2F4752022CC3'),
('06E6FE52-CB53-48DB-9E0C-24D5C5BB9B80'),('206B504B-428F-45FD-B49A-A14E6E98CE71'),('C935D206-BB9A-4FBA-9DD1-99FE0BB405B1'),('2D9B75B2-1945-42BD-9251-48D5E94AA8AF'),
('EA8429D0-D29E-4B70-A329-A5C040696B4F'),('15D60AA9-264F-4392-9A5A-9D7525478A2F'),('1DC1CFB8-EC9F-443A-8E8C-D79B5131571D'),('6529925C-2FE9-4EB1-9EA4-709008B193E2'),
('3714A3F9-6F8F-4874-AB7E-5A5EA451F664'),('7384384B-CC8C-43F9-BABD-77C53F88D0B4'),('E700CE87-FE37-42EE-8D11-D996E4B9A382'),('C6D8159D-610F-464C-B1E2-56F6FEA7717A'),
('CC33A326-1ED3-4482-9FC8-447BE4684DB0'),('2C0E675B-DFA8-4D29-9009-A5572C830A99'),('66CF191E-81C5-4E97-A9FB-0C1EA16F5D0F'),('DAB130E3-3A79-426A-B6F5-05B270034386'),
('86D53D22-32BF-4BF1-8AB7-10D13C2D1499'),('8C178E3F-5C3A-4156-A919-DB4BF1C10803'),('85122067-C16B-4DF5-BB60-90E668DB4ACE'),('D933652E-9C7D-4AA2-92A1-AB09603D9AB5'),
('68E34FA1-88A3-45B5-B4DC-74295D825524'),('3F6AABDD-F862-45E0-A106-D807BFF9DECC'),('1D6700F3-E987-4942-BAC3-FFD6826A7ABB'),('F9635EDA-B35E-42CB-A62B-B30BE9FE8996'),
('2CD2482C-7CD0-4481-9DA7-4E903B0121CF'),('1AB9992B-353E-4DB1-94A5-1FC1E5C82CF1'),('D5CC4336-DC76-4176-B0E0-8F38A4D1CDFB'),('C7563D5D-DD55-469E-A949-91F3889DB1EC'),
('EED76127-2073-4D5C-8661-ED7A9BEC20A6'),('41294113-9D23-4D7D-8260-32E368907DAB'),('3A0EA62C-0AC7-411C-8BCA-C93C09029B46'),('82F35381-E2CF-4E06-9948-492DD8EF84A7'),
('F820CA0B-45B6-4025-AFC3-BBDDEA693F39'),('42A3386B-9A91-41F0-B1FE-1001D860761D'),('63E3DDB9-7AC7-4F1D-8CB4-DB664D0562D7'),('DD848521-92B0-4120-9A47-6BE4A63C4C3B'),
('553F1B94-7C58-40C3-94EC-41BDD07CFAE5'),('04A77D50-48B3-4E64-8383-6702F86981E8'),('D7172294-9813-425F-8BA3-9BF4580380AB'),('32E8C533-1BA6-42AF-937C-1BF65086698F'),
('E0E7DBF8-5A43-4C80-9E72-D273F74588CF'),('DFAD8D8D-0FE6-4A9E-BB7D-D660448B3F43'),('689ADBEB-4BCA-4668-A952-863AC330F6CE'),('031F3E93-DDF6-4598-8F55-2605E1EFFDE2'),
('69E8DF4F-79CA-4F22-82DA-9471684CB7BF'),('E1D542F8-AA2B-4306-BCB2-8EE63D396F3B'),('38016443-E953-424F-A278-DD81637E7677'),('1212D53D-79C9-4D95-B9CE-A40EFFEBF4C7'),
('05EC4CE4-8D9E-4F13-918B-4D41D0CD0CCF'),('181E2658-953C-408F-8A40-FDD77C30E65A'),('DE4B0E1F-5EAD-4E92-BC76-C3059A8C96CF'),('2293DBCB-488B-4882-B7FD-D28FDBD6AE29'),
('6DE82A29-961F-40ED-AF00-BFFCFCB58CBB'),('3310ECA9-CAB5-419E-A671-CAEE66643AE5'),('572131A2-4C4A-443E-8C81-0ED818A0BB7D'),('2C3DCFD5-B456-4AC3-82B2-EF6F455E7823'),
('D51CF0C1-D254-44A9-9C28-CAD86A745F34'),('E4CB1A7C-B9A0-4A31-8397-B8288C373C86'),('5A910442-080C-4C65-964E-EFC72569044B'),('E9B6CB7F-D00F-412F-863C-5DE3472FE15D'),
('8F7B8D6A-9057-421D-B35F-75215C038AE7'),('05C1A78E-183E-40A5-974C-8BC22185CFC1'),('DEABFD14-F8F2-467D-8E3D-8ED7F3F2D332'),('959AEB34-E59B-49CA-B350-EEDE5A347365'),
('890B57E5-64CF-4DD5-AB65-40F41D22F30B'),('911FE755-9DFD-4049-89D7-2CF5084362EA'),('B1C85E4D-7C19-4637-970F-37388065B37D'),('53B695B3-D25F-4354-A47E-5EE187E1F89E'),
('4716563B-355B-4387-ACC0-EF3ED905ADF4'),('2998FDDA-FF06-4D63-873A-44FB6BF07548'),('A32FCAD3-CA6B-4F87-B345-DBB27B8E354F'),('CC4CB628-E384-4B95-9E52-DA04F54BE96E'),
('B7A555F7-4055-4946-8267-514801BE031C'),('42469301-72ED-4576-AA2A-E4396BADF0B9'),('6BCA9B26-AA04-4DFC-8DE9-FEE811A02B30'),('C6EC5DF9-34E1-4F11-A3FE-2D7626FAF1FF'),
('9AC6A6C2-1965-4EDE-BBA2-A0171A737CCE'),('BB9D7EE6-6CE7-4CD9-8045-7FBC4855978A'),('D6899750-4A37-4045-BDD1-AEB773E05295'),('C470D729-AE22-43CB-9E7D-79BC3C689D32'),
('892AE070-BEC4-4EC8-9FF1-2A596E6E4A3E'),('9121D636-4C9D-47DC-9CF7-AA19C7879337'),('F82F8385-FE92-49F7-9B62-3768DA1D3CF6'),('96CB7240-4E14-4F84-A2A4-296B517428EB'),
('023B9565-565C-44CE-9AEE-9CD7E423B31B'),('5AFE936A-7804-43D7-B052-A41CD54F5D64'),('62FA8D1F-1261-4FFF-B651-325853BD1099')

SELECT f.FileNameHR,a.Account,a.DateRegister,a.ReportYear,a.ReportMonth,COUNT(DISTINCT cc.GUID_ZSL)
FROM dbo.t_File f INNER JOIN dbo.t_RegistersAccounts a ON
			f.id=a.rf_idFiles
					INNER JOIN dbo.t_RecordCasePatient r ON
			a.id=r.rf_idRegistersAccounts
					INNER JOIN dbo.t_PatientSMO ps ON
            r.id=ps.rf_idRecordCasePatient
					INNER JOIN dbo.t_Case c ON
			r.id=c.rf_idRecordCasePatient	
					INNER JOIN dbo.t_CompletedCase cc ON
			r.id=cc.rf_idRecordCasePatient	
					JOIN #t tt ON
            tt.GUID_ZSL = cc.GUID_ZSL
WHERE f.DateRegistration>@dateStart AND f.DateRegistration<@dateEnd AND a.ReportYear=2021
GROUP BY f.FileNameHR,a.Account,a.DateRegister,a.ReportYear,a.ReportMonth
GO
DROP TABLE #t
