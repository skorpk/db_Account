USE AccountOMS
go
DECLARE @codeM CHAR(6)='471001'
DECLARE @tsnils AS TABLE(snils varchar(16),CodeM CHAR(6))
INSERT @tsnils( CodeM,snils )
VALUES ('361001','033-881-411 51'),('361001','017-217-495 36'),('361001','017-217-188 28'),('361001','122-704-734 27'),('361001','017-216-379 29'),('361001','136-149-542 61'),
		('361001','017-217-354 24'),('361001','017-217-440 21'),('361001','056-287-493 94'),('361001','017-217-213 12'),('361001','020-637-227 11'),('361001','020-637-229 13'),
		('361001','012-511-354 84'),('361001','072-378-320 67'),('361001','025-011-669 34'),('361001','172-296-786 01'),('361001','015-188-714 47'),('361001','146-451-490 65'),
('361001','013-144-045 84'),('361001','015-188-723 48'),('361001','020-710-076 83'),('361001','028-601-609 38'),('361001','142-377-082 53'),('361001','016-497-325 64'),
('361001','020-637-201 01'),('361001','015-188-719 52'),('361001','013-960-894 58'),('431001','020-273-579 12'),('431001','017-830-858 61'),('431001','013-643-601 15'),
('431001','070-939-048 76'),('431001','019-511-902 38'),('431001','013-643-563 26'),('431001','013-643-564 27'),('431001','160-074-667 44'),('431001','075-505-640 66'),
('431001','020-273-657 09'),('431001','013-643-642 24'),('431001','008-941-508 56'),('431001','020-933-578 33'),('431001','070-939-039 75'),
('431001','070-645-876 75'),('431001','104-140-136 78'),('431001','141-209-345 17'),('431001','020-933-590 29'),('511001','017-839-794-98'),
('511001','018-857-343 84'),
('511001','089-384-817-32'),
('511001','135-901-898 75'),
('511001','017-839-917-91'),
('511001','017-839-826 89'),
('511001','014-525-239-16'),
('511001','014-525-249-18'),
('511001','155-123-634 39'),
('511001','012-517-655-17'),
('511001','017-663-651-63'),
('511001','017-663-636-64'),
('511001','109-785-889-21'),
('511001','014-525-226-11'),
('541001','057-205-644 50'),
('541001','019-368-195 76'),
('541001','100-687-522 33'),
('541001','013-155-933 15'),
('541001','018-936-975 01'),
('541001','089-643-479 28'),
('541001','010-956-634 38'),
('541001','010-081-458 82'),
('541001','012-420-430 74'),
('541001','018-463-623 54'),
('541001','011-545-938 25'),
('541001','018-463-605 52'),
('541001','154-954-360 92'),('541001','147-919-665 18'),('541001','051-720-459 29'),('391001','066-035-516 47'),
('391001','024-909-181 53'),
('391001','055-190-996 76'),
('391001','015-336-214 11'),
('391001','024-909-540 56'),
('391001','024-909-383 61'),
('391001','024-909-075 52'),
('391001','024-909-076 53'),
('391001','110-929-542 41'),
('391001','138-467-833 02'),
('391001','088-670-236 07'),
('391001','153-534-088 54'),
('391001','024-909-462 59'),
('391001','024-909-398 68'),
('391001','024-909-421 50'),
('391001','024-909-072 49'),
('391001','122-397-289 60'),
('391001','018-458-557 76'),
('391001','018-458-569 80'),
('391001','018-458-542 69'),
('391001','024-909-465 62'),
('391001','117-383-897 84'),
('391001','024-909-348 58'),
('391001','066-132-835 53'),
('391001','137-152-973 64'),
('391001','066-132-877 63'),
('391001','024-909-221 44'),
('391001','065-802-423 57'),
('391001','020-640-207 85'),
('391001','159-455-939 21'),
('391001','129-773-697 18'),
('391001','066-132-838 56'),
('391001','018-458-541 68'),
('391001','024-909-415 52'),
('391001','045-471-519 55'),
('391001','024-909-373 59'),
('391001','066-132-841 51'),
('391001','045-471-514 50'),
('391001','024-909-471 60'),
('391001','024-909-469 66'),
('391001','024-909-408 53'),
('391001','122-531-529 15'),
('391001','024-909-437 58')




SELECT DISTINCT f.CodeM,s.snils,p.Fam+' '+p.Im+' '+ISNULL(p.Ot,'') AS FIO,m.DateHelpBegin, m.DateHelpEnd
FROM dbo.t_File f INNER JOIN dbo.t_RegistersAccounts a ON
			f.id=a.rf_idFiles
					INNER JOIN dbo.vw_sprT001 l ON
			f.CodeM=l.CodeM	 			                  
				  INNER JOIN dbo.t_RecordCasePatient r ON
			a.id=r.rf_idRegistersAccounts
				 INNER JOIN dbo.t_RegisterPatient p ON
			r.id=p.rf_idRecordCase
			AND f.id=p.rf_idFiles
				INNER JOIN dbo.t_Case c ON
			r.id=c.rf_idRecordCasePatient
				INNER JOIN dbo.t_Meduslugi m ON
			c.id=m.rf_idCase
				INNER JOIN @tsnils s ON
			RTRIM(m.rf_idDoctor)=REPLACE(replace(s.snils,'-',''),' ','')
			AND f.CodeM=s.CodeM
WHERE f.DateRegistration>'20150101' AND f.DateRegistration<'20151001' AND l.filialCode=3 /*f.CodeM=@codeM*/ AND a.ReportYear=2015

